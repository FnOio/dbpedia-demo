<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>DBpedia Demo - RML and FnO</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link href="assets/css/freelancer.min.css" rel="stylesheet"/>
    <link href="assets/css/nprogress.css" rel="stylesheet"/>

    <link href="assets/css/style.css" rel="stylesheet"/>

    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"
          integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" type="text/css">
</head>
<body id="page-top" class="index">

<!-- Header -->
<header>
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <!--<img class="img-responsive" src="img/profile.png" alt="">-->
                <div class="intro-text">
                    <span class="name">DBpedia Demo</span>
                    <hr class="star-light">
                    <!--<span class="skills">Web Developer - Graphic Artist - User Experience Designer</span>-->
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Portfolio Grid Section -->
<section id="demo">
    <div class="container">
        <div class="row">
            <div class="col-md-10 col-md-offset-1">
                <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingOne">
                            <h4 class="panel-title">
                                <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="false"
                                   aria-controls="collapseOne">
                                    About
                                </a>
                            </h4>
                        </div>
                        <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
                            <div class="panel-body">
                                <p>
                                    This demo allows you to edit the mapping document that generates DBpedia data.
                                    You can select different examples to the left,
                                    and edit the different elements of the mapping document.
                                    Afterwards, click <kbd>generate</kbd> button to let the RMLProcessor on the server generate some new DBpedia.
                                </p>

                                <p>
                                    Go ahead! Change the resource URI, change the functions that transform the original data,
                                    or go crazy and edit the original RML document under the <kbd>source</kbd> tab.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-12">
                <p style="text-align: center">
                    Let's
                    <button class="btn btn-primary" id="run">generate</button>
                    some DBpedia data!
                </p>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6" id="input">
                <div>
                    <!-- Nav tabs -->
                    <ul class="nav nav-tabs" role="tablist">
                        <li role="presentation" class="active"><a href="#tab-orig" aria-controls="home" role="tab" data-toggle="tab">Original</a></li>
                    </ul>
                    <!-- Tab panes -->
                    <div class="tab-content">
                        <div role="tabpanel" class="tab-pane active" id="tab-orig">
                            <div class="form-group">
                                <label for="uri" class="floating-label-form-group">URI</label>
                                <input id="uri" type="text" class="form-control" value="http://en.dbpedia.org/resource/{{wikititle}}"/>
                            </div>
                            <hr/>
                            <div id="poms"></div>
                        </div>
                    </div>

                </div>
            </div>
            <div class="col-sm-6" id="output">
                <div>
                    <!-- Nav tabs -->
                    <ul class="nav nav-tabs" role="tablist">
                        <li role="presentation" class="active"><a href="#tab-orig-output" aria-controls="home" role="tab" data-toggle="tab">Original Output</a>
                        </li>
                    </ul>
                    <!-- Tab panes -->
                    <div class="tab-content">
                        <div role="tabpanel" class="tab-pane active" id="tab-orig-output">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Footer -->
<footer class="text-center">
    <div class="footer-above">
        <div class="container">
            <div class="row">
                <div class="footer-col col-md-4">
                    <h3>Contact</h3>
                    <p>
                        <a href="mailto:ben.demeester@ugent.be">Ben De Meester</a><br/>
                        <a href="mailto:anastasia.dimou@ugent.be">Anastasia Dimou</a>
                    </p>
                </div>
                <div class="footer-col col-md-4">
                    <h3>Technologies</h3>
                    <p>
                        <a href="http://rml.io">RML</a><br/>
                        <a href="http://users.ugent.be/~bjdmeest/function">FnO</a><br/>
                        for <br/>
                        <a href="http://dbpedia.org">DBpedia</a>
                    </p>
                </div>
                <div class="footer-col col-md-4">
                    <h3>Publications</h3>
                    <p>Soon!</p>
                </div>
            </div>
        </div>
    </div>
    <div class="footer-below">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    Data Science Lab &mdash; imec &mdash; Ghent University &copy; 2016 &mdash; 2017
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- Scroll to Top Button (Only visible on small and extra-small screen sizes) -->
<div class="scroll-top page-scroll hidden-sm hidden-xs hidden-lg hidden-md">
    <a class="btn btn-primary" href="#page-top">
        <i class="fa fa-chevron-up"></i>
    </a>
</div>

<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
        integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="assets/js/nprogress.js"></script>
<!--<script src="assets/js/script.js"></script>-->
<script>
    var map = {"MAP": true};
</script>
<script>
    $(function () {
        hydrateMap(map);
        $('#run').on('click', function (e) {
            map = generateMap(map);
            e.stopPropagation();
            NProgress.start();
            $('#tab-orig-output').html('<pre><code>Fetching the content, please hold on...</code></pre>');
            $.ajax({
                type: "POST",
                url: '<%ENDPOINT%>_dbpedia',
                data: JSON.stringify(map),
                headers: {'Content-Type': 'text/plain'},
                success: function (data, status, jqXHR) {
                    if (jqXHR.status !== 200) {
                        $('#tab-orig-output').html('<pre><code>Something went wrong, please try again, or refresh the page</code></pre>');
                    }
                    else {
                        $('#tab-orig-output').html('<pre><code>' + data.replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</code></pre>');
                    }
                    NProgress.done();
                },
                error: function () {
                    $('#tab-orig-output').html('<pre><code>Something went wrong, please try again, or refresh the page</code></pre>');
                    NProgress.done();
                }
            });

        });
    });

    function hydrateMap(map) {
        $('#uri').val(map['dbf:doc']['rr:subjectMap']['rr:constant']['@value']);
        var poms = map['dbf:doc']['rr:predicateObjectMap'];
        var $pomDiv = $('#poms');
        for (var i = 0; i < poms.length; i++) {
            var fn = {};
            var fnPoms = poms[i]['rr:objectMap']['fnml:functionValue']['rr:predicateObjectMap'];
            for (var j = 0; j < fnPoms.length; j++) {
                var inbetween = fnPoms[j]['rr:objectMap']['rr:constant'] ? fnPoms[j]['rr:objectMap']['rr:constant'] : fnPoms[j]['rr:objectMap']['rml:reference'];
                var value = inbetween['@id'] ? inbetween['@id'] : inbetween['@value'];
                fn[fnPoms[j]['rr:predicate']['@id']] = value;
            }
            var $el = $('<div>' +
                '<div class="form-group">' +
                '<label for="pom_' + i + '">Predicate</label>' +
                '<input class="form-control" type="text" id="pom_' + i + '" value="' + poms[i]['rr:predicate']['@id'] + '"/>' +
                '</div>' +
                '<div class="form-group">' +
                '<label for="fnPom_' + i + '">Function</label>' +
                '<input class="form-control" type="text" id="fnPom_' + i + '" value="' + fn['fno:executes'] + '"/>' +
                '</div>' +
                '<div class="form-group">' +
                '<label for="inputPom' + i + '">Input</label>' +
                '<input class="form-control" type="text" id="inputPom_' + i + '" value="' + fn['dbf:propertyParameter'] + '"/>' +
                '</div>' +
                '</div><hr/>');
            $pomDiv.append($el);
        }

    }

    function generateMap(map) {
        map['dbf:doc']['rr:subjectMap']['rr:constant']['@value'] = $('#uri').val();
        var poms = map['dbf:doc']['rr:predicateObjectMap'];
        var $pomDiv = $('#poms');
        for (var i = 0; i < poms.length; i++) {
            poms[i]['rr:predicate']['@id'] = $('#pom_' + i).val();
            var fnPoms = poms[i]['rr:objectMap']['fnml:functionValue']['rr:predicateObjectMap'];
            for (var j = 0; j < fnPoms.length; j++) {
                if (fnPoms[j]['rr:predicate'] === 'fno:executes') {
                    fnPoms[j]['rr:objectMap']['rr:constant']['@id'] = $('#fnPom_' + i).val();
                }
                if (fnPoms[j]['rr:predicate'] === 'dbf:propertyParameter') {
                    fnPoms[j]['rr:objectMap']['rml:refernce']['@value'] = $('#inputPom_' + i).val();
                }
            }
        }
        return map;
    }
</script>
</body>
</html>